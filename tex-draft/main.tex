%%
%% This is file `sample-acmlarge.tex',
%% generated with the docstrip utility.
%%
%% The original source files were:
%%
%% samples.dtx  (with options: `all,journal,bibtex,acmlarge')
%% 
%% IMPORTANT NOTICE:
%% 
%% For the copyright see the source file.
%% 
%% Any modified versions of this file must be renamed
%% with new filenames distinct from sample-acmlarge.tex.
%% 
%% For distribution of the original source see the terms
%% for copying and modification in the file samples.dtx.
%% 
%% This generated file may be distributed as long as the
%% original source files, as listed above, are part of the
%% same distribution. (The sources need not necessarily be
%% in the same archive or directory.)
%%
%%
%% Commands for TeXCount
%TC:macro \cite [option:text,text]
%TC:macro \citep [option:text,text]
%TC:macro \citet [option:text,text]
%TC:envir table 0 1
%TC:envir table* 0 1
%TC:envir tabular [ignore] word
%TC:envir displaymath 0 word
%TC:envir math 0 word
%TC:envir comment 0 0
%%
%%
%% The first command in your LaTeX source must be the \documentclass
%% command.
%%
%% For submission and review of your manuscript please change the
%% command to \documentclass[manuscript, screen, review]{acmart}.
%%
%% When submitting camera ready or to TAPS, please change the command
%% to \documentclass[sigconf]{acmart} or whichever template is required
%% for your publication.
%%
%%
\documentclass[manuscript, review, timestamp]{acmart}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%


\usepackage{color}
\usepackage{amsmath}
%\usepackage{amssymb}
\usepackage{graphicx}
\usepackage{amsthm}
\usepackage{stmaryrd}
\usepackage[all]{xy}
\usepackage{multirow}
\usepackage{paralist}
\usepackage{hhline}
\usepackage{bm}
\usepackage{braket}
\usepackage{pifont}% http://ctan.org/pkg/pifont
\newcommand{\cmark}{\CIRCLE}%
\newcommand{\xmark}{\Circle}%
\newcommand{\hmark}{\LEFTcircle}%
\renewcommand{\matrix}[1]{\begin{bmatrix}#1\end{bmatrix}}
\usepackage{wasysym}
\usepackage{extarrows}
\usepackage{tikz}
\usetikzlibrary{positioning, shapes.geometric, graphs}
\usepackage{wrapfig}
\usepackage{dsfont}



%%
%% \BibTeX command to typeset BibTeX logo in the docs
\AtBeginDocument{%
  \providecommand\BibTeX{{%
    Bib\TeX}}}

%% Rights management information.  This information is sent to you
%% when you complete the rights form.  These commands have SAMPLE
%% values in them; it is your responsibility as an author to replace
%% the commands and values with those provided to you when you
%% complete the rights form.

%%
%% Submission ID.
%% Use this when submitting an article to a sponsored event. You'll
%% receive a unique submission ID from the organizers
%% of the event, and this ID should be used as the parameter to this command.
%%\acmSubmissionID{123-A56-BU3}

%%
%% For managing citations, it is recommended to use bibliography
%% files in BibTeX format.
%%
%% You can then either use BibTeX with the ACM-Reference-Format style,
%% or BibLaTeX with the acmnumeric or acmauthoryear sytles, that include
%% support for advanced citation of software artefact from the
%% biblatex-software package, also separately available on CTAN.
%%
%% Look at the sample-*-biblatex.tex files for templates showcasing
%% the biblatex styles.
%%

%%
%% The majority of ACM publications use numbered citations and
%% references.  The command \citestyle{authoryear} switches to the
%% "author year" style.
%%
%% If you are preparing content for an event
%% sponsored by ACM SIGGRAPH, you must use the "author year" style of
%% citations and references.
%% Uncommenting
%% the next command will enable that style.
%%\citestyle{acmauthoryear}

\newcommand{\yx}[1]{\textit{\color{blue}[YX] : #1}}


\newcommand*{\Sc}{\mathcal{S}}
\newcommand*{\K}{\mathcal{K}}
\newcommand*{\B}{\mathcal{B}}
\newcommand*{\Op}{\mathcal{O}}

\newcommand*{\type}{\texttt{type}}

\newcommand*{\unit}{\texttt{unit}}
\newcommand*{\utt}{\texttt{tt}}
\newcommand*{\fst}{\texttt{fst }}
\newcommand*{\snd}{\texttt{snd }}
\newcommand*{\reduce}{\ \triangleright\ }
\newcommand*{\reducefrom}{\ \triangleleft\ }

\newcommand*{\zeroK}[1]{\mathbf{0}_{\mathcal{K}(#1)}}
\newcommand*{\zeroB}[1]{\mathbf{0}_{\mathcal{B}(#1)}}
\newcommand*{\zeroO}[1]{\mathbf{0}_{\mathcal{O}(#1)}}

\newcommand*{\sem}[1]{{\llbracket #1 \rrbracket}}

\newcommand*{\done}{\textcolor{blue}{\textbf{ [DONE] }}}
\newcommand*{\doing}{\textcolor{red}{\textbf{ [DOING] }}}
\newcommand*{\pending}{\textcolor{gray}{\textbf{ [PENDING] }}}


%%
%% end of the preamble, start of the body of the document source.
\begin{document}

%%
%% The "title" command has an optional parameter,
%% allowing the author to define a "short title" to be used in page headers.
\title{Decision Procedure for Dirac Notations}

%%
%% The "author" command and its associated commands are used to define
%% the authors and their affiliations.
%% Of note is the shared affiliation of the first two authors, and the
%% "authornote" and "authornotemark" commands
%% used to denote shared contribution to the research.

%%
%% By default, the full list of authors will be used in the page
%% headers. Often, this list is too long, and will overlap
%% other information printed in the page headers. This command allows
%% the author to define a more concise list
%% of authors' names for this purpose.

%%
%% The abstract is a short summary of the work to be presented in the
%% article.
\begin{abstract}
\end{abstract}

%%
%% The code below is generated by the tool at http://dl.acm.org/ccs.cfm.
%% Please copy and paste the code instead of the example below.
%%

%%
%% Keywords. The author(s) should pick words that accurately describe
%% the work being presented. Separate the keywords with commas.

%%
%% This command processes the author and affiliation and title
%% information and builds the first part of the formatted document.
\maketitle

Yingte TODO list (Jun 7 - Jun 14): 
\begin{itemize}
    \item Update tool implementation
    \begin{itemize}
        \item \done Consider entry expansion with typing information
        \item \done Implement type checking
        \item Implement user language, output notation and type unification.
    \end{itemize}
    \item Prove Termintation (without fst and snd)
    \item Consider quantifier elimination in implementation
    \item Write the examples
\end{itemize}

Li TODO list (Jun 7 - Jun 14):
\begin{enumerate}
    \item Coq formalization of soundness (typing rule + rewriting rule)
    \item (Possible) rewrite part of introduction
\end{enumerate}


Technical TODO list :
\begin{itemize}
    \item \done Modify the internal untyped TRS and introduce type information. Try to encode type inferrence as rewriting rules.
        \begin{itemize}
            \item $0, 1$ symbol: type decoration
            \item variables: specified by a context, encoded as rewriting rules $\sigma(x) \reduce ...$
            \item composed terms: specified by typing rules, encoded by $TypeEval(...) \reduce ...$
        \end{itemize}
        This should also resolve the problem of specifiying the ``type'' for the universal set.
    \item \pending update the tool implementation
    %\item Consider the typed formal system for Dirac notation $\mathcal{E}_{T}$ and its conversion to the untyped internal language .
    \item \done confluence (amend the original CiME2 code).
    \item \pending termination: the APRoVE tools failed to generate the proof automatically. Hard to find appropriate interpretation. 
    \item \done fix the semantics
    \item \done Check: can transpose be constructed? (ANS: yes, so we remove the syntax from the extended Dirac notation.)
    \item \pending soundness (typing rule + rewriting rule)
    \item \pending completeness. 1. typed dirac (semantics equal); 2. axiom of typed dirac, i.e., equational axioms, prove the equational theory is relatively complete w.r.t. semantics equality??? ; 3. rewriting system is complete w.r.t. equational axioms (pointing out the importance and difficulty of TRS w.r.t. the equational theories)
    \item \pending Coq formalization of soundness (extended with big op) and completeness (core language)
    \item \pending explain the techniques applied in the implementation of extended langauge
        \begin{itemize}
            \item (SUM-SWAP) equation
            \item alpha-equivalence of sum index: using AC-unification
            \item entry-expansion techniques to improve automation
        \end{itemize}
    \item \pending a user language that will be compiled to the internal one (benefit: avoid different symbols for disambiguating )
    \item \pending add labelled Dirac notation
    \item \pending examples show the efficiency, add a long example
    \item \pending examples from other fields of quantum computing: circuit equivalence checking and program simulation
\end{itemize}

\clearpage
\tableofcontents

\clearpage

\input{01Introduction.tex}

\input{02MotivatingExample.tex}

\input{03Background.tex}

\input{04CoreLanguage.tex}

\input{05DecisionProc.tex}

\input{06ExtendedLanguage.tex}

\input{07Implementation.tex}

\input{08CaseStudy.tex}

\input{09RelatedWork.tex}

\input{10Conclusion.tex}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%


\bibliographystyle{plain}
\bibliography{ref}

\clearpage
\appendix


\section{Core Language Syntax, Typing and Semantics (Full Version)}

\begin{definition} [atomic basis signature]
  The \textbf{atomic basis signature} $\Sigma_\mathcal{A}$ is a  typed finite language.
\end{definition}

\begin{definition} [complex number signature]
  The \textbf{complex number signature} $\Sigma_\mathcal{C}$ contains at least constant symbols $0, 1$, a unary symbol $*$ and binary symbols $+, \times$.
\end{definition}

\begin{definition}[core language of Dirac Notation]
  The \textbf{core language of Dirac Notation}, denoted as $\textsf{DN}(\Sigma_\mathcal{A}, \Sigma_\mathcal{C})$, is a many-sorted language with dependent types, defined as follows.
  \begin{align*}
    & \textbf{Kinds} && \textrm{(basis kind)} && P ::= \texttt{Atom}\ |\ P * P, \\
    & && \textrm{(Dirac kind)} && D ::= \texttt{Scalar}\ |\ \texttt{Ket}\ |\ \texttt{Bra}\ |\ \texttt{Operator}, \\
    \\
    & \textbf{Types} && \textrm{(basis types)} && \sigma ::= x\ |\ A\ |\ \sigma \times \sigma\ |\ \pi_1(\sigma)\ |\ \pi_2(\sigma)\ |\ \pi_K(T)\ |\ \pi_B(T)\ |\ \type(t), \\
    & && \textrm{(Dirac types)} && T ::= x\ |\ \Sc\ |\ \K(\sigma)\ |\ \B(\sigma)\ |\ \Op(\sigma, \sigma)\ |\ \type(S)\ |\ \type(K)\ |\ \type(B)\ |\ \type(O), \\
    \\
    & \textbf{Terms} && \textrm{(complex number)} && \alpha \in \Sigma_\mathcal{C}, \\
    & && \textrm{(basis)} && t ::= x\ |\ a\ |\ (t, t)\ |\ \fst t\ |\ \snd t, \\
    & && \textrm{(scalar)} && S ::= x\ |\ C(\alpha)\ |\ \delta_{t, t}\ |\ S + S\ |\ S \times S\ |\ S^*\ |\ B \cdot K, \\
    & && \textrm{(ket)} && K ::= x\ |\ \mathbf{0}_\mathcal{K}(\sigma)\ |\ \ket{t}\ |\ B^\dagger\ |\ S.K\ |\ K + K\ |\ O \cdot K\ |\ K \otimes K, \\
    & && \textrm{(bra)} && B ::= x\ |\ \mathbf{0}_\mathcal{B}(\sigma)\ |\ \bra{t}\ |\ K^\dagger\ |\ S.B\ |\ B + B\ |\ B \cdot O\ |\ B \otimes B, \\
    & && \textrm{(operator)} && O ::= x\ |\ \mathbf{0}_\mathcal{O}(\sigma, \sigma)\ |\ \mathbf{1}_\mathcal{O}(\sigma)\ |\ K \otimes B\ |\ O^\dagger\ |\ S.O\ |\ O + O\ |\ O \cdot O\ |\ O \otimes O.
  \end{align*}
  Here we use $x$ to represent variables, $a$ to represent atomic basis in $\Sigma_\mathcal{A}$, lower case letters like $s, t$ to represent basis from $\mathcal{E}$, and Greek letters like $\alpha$ to represent complex number terms from $\Sigma_\mathcal{C}$. We use letters $S$, $K$, $B$, $O$ and their variants to represent terms from the scalar, ket, bra and operator sorts repsectively.
\end{definition}

\subsection{Context and Typing}

\begin{definition}[context]
  A \textbf{typing assumption} is written as $x : X$, meaning that variable $x$ is of type $X$. A \textbf{context} $\Gamma$ is an ordered list of typing assumptions. We write $x : X \in \Gamma$ if the typing assumption is contained in context $\Gamma$, and $x \in \Gamma$ if there exists a typing assumption of $x$ contained in $\Gamma$.
\end{definition}


We define simultaneously two judgement. One is $\mathcal{WF}(\Gamma)$, meaning that a context is \textbf{well-formed}. And the second one is a \textbf{typing judgement} written as $\Gamma \vdash e : X$, indicating that $e$ is an expression of type $X$ in context $\Gamma$.
We say the term $e$ is a \textbf{well-typed} term in context $\Gamma$ if $\Gamma \vdash e : X$ is a typing judgement for some $X$.

Well-formed contexts can be constructed starting with an empty context, and continuously appending unique variables with proved typing judgements.

\textsc{(Well-formed Context)}
\begin{gather*}
  \frac{}{\mathcal{WF}([])}
  \qquad
  \frac{\Gamma \vdash T : X \qquad x \notin \Gamma}{\mathcal{WF}(\Gamma :: (x : T))}
\end{gather*}

The typing judgements can be proved by the typing rules in the below.

\textsc{(Context)}
\begin{gather*}
  \frac{\mathcal{WF}(\Gamma) \qquad x : \sigma \in \Gamma}{\Gamma \vdash x : \sigma}
\end{gather*}

\textsc{(Basis Type)}
\begin{gather*}
  \frac{\mathcal{WF}(\Gamma)}{\Gamma \vdash A : \texttt{Atom} }
  \qquad
  \frac{\Gamma \vdash \sigma_1 : P_1 \qquad \Gamma \vdash \sigma_2 : P_2}{\Gamma \vdash \sigma_1 \times \sigma_2 : P_1 * P_2}
  \qquad
  \frac{\Gamma \vdash \sigma : P_1 * P_2}{\Gamma \vdash \pi_1(\sigma) : P_1}
  \qquad
  \frac{\Gamma \vdash \sigma : P_1 * P_2}{\Gamma \vdash \pi_2(\sigma) : P_2} \\
  \\
  \frac{\Gamma \vdash T : \K(\sigma)}{\Gamma \vdash \pi_K(T) : P}
  \qquad
  \frac{\Gamma \vdash T : \B(\sigma)}{\Gamma \vdash \pi_B(T) : P} \qquad
  \frac{\Gamma \vdash T : \Op(\sigma_1, \sigma_2)}{\Gamma \vdash \pi_K(T) : P_1}
  \qquad
  \frac{\Gamma \vdash T : \Op(\sigma_1, \sigma_2)}{\Gamma \vdash \pi_B(T) : P_2}
  \qquad
  \frac{\Gamma \vdash t : \sigma}{\Gamma \vdash \type(t) : P}
\end{gather*}

\textsc{(Dirac Type)}
\begin{gather*}
  \frac{\mathcal{WF}(\Gamma)}{\Gamma \vdash \Sc : \texttt{Scalar}}
  \qquad
  \frac{\Gamma \vdash \sigma : P}{\Gamma \vdash \K(\sigma) : \texttt{Ket}}
  \qquad
  \frac{\Gamma \vdash \sigma : P}{\Gamma \vdash \B(\sigma) : \texttt{Bra}}
  \qquad
  \frac{\Gamma \vdash \sigma_1 : P_1 \qquad \Gamma \vdash \sigma_2 : P_2}{\Gamma \vdash \Op(\sigma_1, \sigma_2) : \texttt{Operator}} \\
  \\
  \frac{\Gamma \vdash S : \Sc}{\Gamma \vdash \type(S) : \texttt{Scalar}}
  \qquad
  \frac{\Gamma \vdash K : \K(\sigma)}{\Gamma \vdash \type(K) : \texttt{Ket}}
  \qquad
  \frac{\Gamma \vdash B : \B(\sigma)}{\Gamma \vdash \type(B) : \texttt{Bra}}
  \qquad
  \frac{\Gamma \vdash O : \Op(\sigma_1, \sigma_2)}{\Gamma \vdash \type(O) : \texttt{Operator}}
\end{gather*}

\textsc{(Basis)}
\begin{gather*}
  \frac{\mathcal{WF}(\Gamma) \qquad a \text{ is an atomic basis of } A}{\Gamma \vdash a : A} \\
  \\
  \frac{\Gamma \vdash s : \tau \qquad \Gamma \vdash t : \sigma}{\Gamma \vdash (s, t) :  \tau \times \sigma }
  \qquad
  \frac{\Gamma \vdash \sigma : P_1 * P_2 \qquad \Gamma \vdash s : \sigma }{\Gamma \vdash \fst s : \pi_1(\sigma)}
  \qquad
  \frac{\Gamma \vdash \sigma : P_1 * P_2 \qquad \Gamma \vdash s : \sigma }{\Gamma \vdash \snd s : \pi_2(\sigma)}
\end{gather*}

\textsc{(Complex Scalar)}
\begin{gather*}
  \frac{\mathcal{WF}(\Gamma)}{\Gamma \vdash C(\alpha) : \Sc}
  \qquad
  \frac{\Gamma \vdash s : \sigma \qquad \Gamma \vdash t : \sigma}{\Gamma \vdash \delta_{s, t} : \Sc} \\
  \\
  \frac{\Gamma \vdash S_1 : \Sc \qquad \Gamma \vdash S_2 : \Sc }{\Gamma \vdash S_1 + S_2 : \Sc }
  \qquad
  \frac{\Gamma \vdash S_1 : \Sc \qquad \Gamma \vdash S_2 : \Sc}{\Gamma \vdash S_1 \times S_2 : \Sc}
  \qquad
  \frac{\Gamma \vdash S : \Sc}{\Gamma \vdash S^* : \Sc}
  \qquad
  \frac{\Gamma \vdash B: \B(\tau) \qquad \Gamma \vdash K : \K(\tau) }{\Gamma \vdash B \cdot K : \Sc }
\end{gather*}

\textsc{(Ket)}
\begin{gather*}
  \frac{\mathcal{WF}(\Gamma)}{\Gamma \vdash \mathbf{0}_{\mathcal{K}}(\tau) : \K(\tau)}
  \qquad
  \frac{\Gamma \vdash t : \tau}{\Gamma \vdash \ket{t} : \K(\tau)}
  \qquad
  \frac{\Gamma \vdash K : \K(\tau)}{\Gamma \vdash K^\dagger : \B(\tau)}
  \qquad
  \frac{\Gamma \vdash a : \Sc \qquad \Gamma \vdash K : \K(\tau)}{\Gamma \vdash a . K : \K(\tau)} \\
  \\
  \frac{\Gamma \vdash K_1 : \K(\tau) \qquad \Gamma \vdash K_2 : \K(\tau) }{\Gamma \vdash K_1 + K_2 : \K(\tau) }
  \qquad
  \frac{\Gamma \vdash O : \Op(\tau, \rho) \qquad \Gamma \vdash K : \K(\rho) }{\Gamma \vdash O \cdot K : \K(\tau) }
  \qquad
  \frac{\Gamma \vdash K_1 : \K(\tau) \qquad \Gamma \vdash K_2 : \K(\rho) }{\Gamma \vdash K_1 \otimes K_2 : \K(\tau \times \rho)}
\end{gather*}

\textsc{(Bra)}
\begin{gather*}
  \frac{\mathcal{WF}(\Gamma)}{\Gamma \vdash \mathbf{0}_{\mathcal{B}}(\tau) : \B(\tau)}
  \qquad
  \frac{\Gamma \vdash t : \tau}{\Gamma \vdash \bra{t} : \B(\tau)}
  \qquad
  \frac{\Gamma \vdash B : \B(\tau)}{\Gamma \vdash B^\dagger : \K(\tau)}
  \qquad
  \frac{\Gamma \vdash a : \Sc \qquad \Gamma \vdash B : \B(\tau)}{\Gamma \vdash a . B : \B(\tau)} \\
  \\
  \frac{\Gamma \vdash B_1 : \B(\tau) \qquad \Gamma \vdash B_2 : \B(\tau) }{\Gamma \vdash B_1 + B_2 : \B(\tau) }
  \qquad
  \frac{\Gamma \vdash B : \B(\tau) \qquad \Gamma \vdash O : \Op(\tau, \rho) }{\Gamma \vdash B \cdot O : \B(\rho) } 
  \qquad
  \frac{\Gamma \vdash B_1 : \B(\tau) \qquad \Gamma \vdash B_2 : \B(\rho) }{\Gamma \vdash B_1 \otimes B_2 : \B(\tau \times \rho)}
\end{gather*}

\textsc{(Operator)}
\begin{gather*}
  \frac{\mathcal{WF}(\Gamma)}{\Gamma \vdash \mathbf{0}_{\mathcal{O}}(\tau, \rho) : \Op(\tau, \rho)}
  \qquad
  \frac{\mathcal{WF}(\Gamma)}{\Gamma \vdash \mathbf{1}_{\mathcal{O}}(\tau) : \Op(\tau, \tau)}
  \qquad
  \frac{\Gamma \vdash K : \K(\tau) \qquad \Gamma \vdash B : \B(\rho) }{\Gamma \vdash K \otimes B : \Op(\tau, \rho)}
  \qquad
  \frac{\Gamma \vdash O : \Op(\tau, \rho)}{\Gamma \vdash O^\dagger : \Op(\rho, \tau)} \\
  \\
  \frac{\Gamma \vdash a : \Sc \qquad \Gamma \vdash O : \Op(\tau, \rho)}{\Gamma \vdash a . O : \Op(\tau, \rho)}
  \qquad
  \frac{\Gamma \vdash O_1 : \Op(\tau, \rho) \qquad \Gamma \vdash O_2 : \Op(\tau, \rho) }{\Gamma \vdash O_1 + O_2 : O(\tau, \rho) } \\
  \\
  \frac{\Gamma \vdash O_1 : \Op(\tau, \rho) \qquad \Gamma \vdash O_2 : \Op(\rho, \sigma) }{\Gamma \vdash O_1 \cdot O_2 : \Op(\tau, \sigma) }
  \qquad
  \frac{\Gamma \vdash O_1 : \Op(\tau_1, \rho_1) \qquad \Gamma \vdash O_2 : \Op(\tau_2, \rho_2) }{\Gamma \vdash O_1 \otimes O_2 : \Op(\tau_1 \times \tau_2, \rho_1 \times \rho_2)}
\end{gather*}


\subsection{Denotational Semantics}

Denotational semantics explain the formal language as a process of calculation, where each expression $e$ is finally mapped to a mathematical object written as $\sem{e}$.
Because our language have a hierechy of types, the denotational semantics should reflect the typing relation: types are interpreted as the domain sets, and the typing judgement should be interpreted as set-theoretical membership. This is the consistency requirement we will stick to in the below.

\begin{definition}[typing consistency]
  For any context $\Gamma$, expression $e$ and type $T$, if $\Gamma \vdash e : T$, then $\sem{e} \in \sem{T}$.
\end{definition}

A valuation is also necessary for specifying the interpretation. The valuation $v$ maps all variables $x$ to their interpretation $v(x)$. The semantics of $e$ under valuation $v$ is written as $\sem{e}^v$, and we omit $v$ when it is obvious or assumed.
The valuations satisfying typing consistency are called \textbf{valid} valuations defined below.
\begin{definition}[valid valuation]
  A valuation $v$ is valid in well-formed context $\Gamma$ if for all $x : T \in \Gamma$, $v(x) \in \sem{T}^v$.
\end{definition}

In the following, we give the denotational semantics of core language $\textsf{DN}(\Sigma_\mathcal{A}, \Sigma_\mathcal{C})$. We assume a well-formed context $\Gamma$ and a valid valuation $v$, and only consider the well-typed expressions.

\begin{definition}
  The set of all domains for the semantical interpretation of types in $\Sigma_{\mathcal{A}}$ is written as $\mathcal{A}$.
\end{definition}

\begin{definition}[semantics of kinds] The semantics of kinds are defined as sets of domains as follows:

  \begin{align*}
    & \sem{\texttt{Atom}} \equiv \mathcal{A},
    \qquad
    && \sem{P_1 * P_2} \equiv \{ S_1 \times S_2 : S_1 \in \sem{P_1}, S_2 \in \sem{P_2} \}, \\
    \\
    & \sem{\texttt{Scalar}} \equiv \{ \mathbb{C} \},
    \qquad
    && \sem{\texttt{Ket}} \equiv \{ \mathcal{H}_{\sem{P}} : P \text{ is a basis kind} \}, \\
    & \sem{\texttt{Bra}} \equiv \{ \mathcal{H}^*_{\sem{P}} : P \text{ is a basis kind} \},
    \qquad
    && \sem{\texttt{Operator}} \equiv \{ \textsf{Hom}(S_1, S_2) : S_1, S_2 \in \sem{\texttt{Ket}} \}.
  \end{align*}
\end{definition}

Basis types and Dirac types as terms have their types in kinds. The semantics of types are defined as domains, and should be contained in the semantics of kinds. Therefore, kinds are interpreted as sets of domains. \texttt{Atom} is interpreted as the set $\mathcal{A}$ of all different domains from the atomic basis language, and the kind $P_1 * P_2$ contains all different Cartesian products from $P_1$ and $P_2$. The semantics of \texttt{Ket}, \texttt{Bra} and \texttt{Operator} are defined as the set of all Hilbert spaces, Dual spaces and Homomorphisms, respectively.


\begin{definition}[semantics of types]
  The semantics of basis types are defined as domain sets as follows:
  \begin{align*}
    & \begin{aligned}
      & \sem{A} \equiv \sem{A}_\mathcal{A},
      \qquad
      && \sem{\sigma_1 \times \sigma_2} \equiv \sem{\sigma_1} \times \sem{\sigma_2}, \\
      & \sem{\pi_1(\sigma)} \equiv S_1 \qquad \text{(where $\sem{\sigma} = S_1 \times S_2$)},
      && \sem{\pi_2(\sigma)} \equiv S_2 \qquad \text{(where $\sem{\sigma} = S_1 \times S_2$)}, \\
      & \sem{\pi_K(T)} \equiv \left\{
        \begin{array}{ll}
          S, & \text{ where } \sem{T} = \mathcal{H}_S, \\
          S_1, & \text{ where } \sem{T} = \textsf{Hom}(S_1, S_2),
        \end{array}
      \right.
      && \sem{\pi_B(T)} \equiv \left\{
        \begin{array}{ll}
          S, & \text{ where } \sem{T} = \mathcal{H}^*_S, \\
          S_2, & \text{ where } \sem{T} = \textsf{Hom}(S_1, S_2),
        \end{array}
      \right.
    \end{aligned} \\
    \\
    & \begin{aligned}
      \sem{\Sc} \equiv \mathbb{C},
      \qquad
      \sem{\K(\sigma)} \equiv \mathcal{H}_{\sem{\sigma}}, 
      \qquad 
      \sem{\B(\sigma)} \equiv \mathcal{H}^*_{\sem{\sigma}},
      \qquad
      \sem{\Op(\sigma, \tau)} \equiv \textsf{Hom}(\sem{\sigma}, \sem{\tau}),
    \end{aligned} \\
    \\
    & \begin{aligned}
      \sem{\texttt{type}(t)} \equiv \sem{T} \qquad \text{(where $\Gamma \vdash t : T$)}
    \end{aligned}
  \end{align*}
\end{definition}

Because we only consider well-typed terms, the semantics are always well-defined.


\begin{definition}[semantics of basis]
  For atomic basis $\Sigma_\mathcal{A}$ with domain $A$, the domain of basis $\mathcal{E}$ is the binary tree algebra over $A$, which is defined as 
  $
  \mathcal{D}_\mathcal{E} = \mu X.(A \cup (X \times X)),
  $
  the smallest set that contains $A$ and is closed under Cartesian product.

  The semantics of symbols in $\mathcal{E}$ are defined as follows:
  \begin{align*}
    & \text{(Atomic Basis)} && \sem{a} \equiv \sem{a}_\mathcal{A}, \\
    & \text{(Pairing)} &&
    \sem{(t_1, t_2)} \equiv (\sem{t_1}, \sem{t_2}), \\
    & \text{(First Projection)} &&
    \sem{\fst t} \equiv x_1 \qquad (\text{where } \sem{t} = (x_1, x_2)), \\
    & \text{(Second Projection)} &&
    \sem{\snd t} \equiv x_2 \qquad (\text{where } \sem{t} = (x_1, x_2))
  \end{align*}
\end{definition}


\begin{definition}[semantics of scalar]
  The domain of scalars $\mathcal{D}_\mathcal{S} = \mathbb{C}$ is the complex field.
  The semantics of the symbols are defined as follows:
  \begin{align*}
    & \text{(Complex Number)} &&
    \sem{C(\alpha)} \equiv \sem{\alpha}_\mathcal{C}, \\
    & \text{(Kronecker Delta)} &&
    \sem{\delta_{s, t}} \equiv \left\{
      \begin{array}{ll}
        1, & \text{where } \sem{s} = \sem{t}, \\
        0, & \text{where } \sem{s} \neq \sem{t}, 
      \end{array}
    \right. \\
    & \text{(Addition)} &&
    \sem{S_1 + S_2} \equiv \sem{S_1} + \sem{S_2}, \\
    & \text{(Multiplication)} &&
    \sem{S_1 \times S_2} \equiv \sem{S_1} \times \sem{S_2}, \\
    & \text{(Conjugate)} &&
    \sem{S^*} \equiv \sem{S}^*, \\
    & \text{(Inner Product)} &&
    \sem{B \cdot K} \equiv \langle \sem{B}^*, \sem{K} \rangle.
  \end{align*}
\end{definition}

\begin{definition}[semantics of ket/bra]
  The domain for the semantics of ket and bra are $\mathcal{H}_{\mathcal{D}_\mathcal{E}}$ and $\mathcal{H}_{\mathcal{D}_\mathcal{E}}^*$ respectively.
  The symbols are explained as follows:
  \begin{align*}
    & \text{(Zero Vector)} &&
    \sem{\mathbf{0}_\mathcal{K}(\sigma)} \equiv \mathbf{0} && \sem{\mathbf{0}_\mathcal{B}(\sigma)} \equiv \mathbf{0}^*, \\
    & \text{(Basis Vector)} &&
    \sem{\ket{t}} \equiv \mathbf{e}_t && \sem{\bra{t}} \equiv \mathbf{e}^t, \\
    & \text{(Adjoint)} &&
    \sem{B^\dagger} \equiv \sem{B}^* && \sem{K^\dagger} \equiv \sem{K}^*, \\
    & \text{(Scalar Multiplication)} &&
    \sem{S.K} \equiv \sem{S} \sem{K} && \sem{S.B} \equiv \sem{S} \sem{B}, \\
    & \text{(Addition)} &&
    \sem{K_1 + K_2} \equiv \sem{K_1} + \sem{K_2} && \sem{B_1 + B_2} \equiv \sem{B_1} + \sem{B_2}, \\
    & \text{(Linear Operator)} &&
    \sem{O \cdot K} \equiv \sem{O} \cdot \sem{K} && \sem{B \cdot O} \equiv (\sem{O}^\dagger \cdot \sem{B}^*)^*, \\
    & \text{(Tensor Product)} &&
    \sem{K_1 \otimes K_2} \equiv \sem{K_1} \otimes \sem{K_2} && \sem{B_1 \otimes B_2} \equiv \sem{B_1} \otimes \sem{B_2}.
  \end{align*}
\end{definition}

\begin{definition}[semantics of operator]
  The domain for the semantics of operators is the homomorphism $\mathcal{D}_\mathcal{O} = \textrm{Hom}(\mathcal{H}_{\mathcal{D}_\mathcal{E}}, \mathcal{H}_{\mathcal{D}_\mathcal{E}})$.
  The symbols are explained as follows:
  \begin{align*}
    & \text{(Zero Operator)} &&
    \sem{\mathbf{0}_\mathcal{O}(\sigma, \tau)} \equiv \mathbf{0}_{\textrm{op}}, \\
    & \text{(Identity Operator)} &&
    \sem{\mathbf{1}_\mathcal{O}(\sigma)} \equiv \mathbf{I}, \\
    & \text{(Outer Product)} &&
    \sem{K \otimes B} \equiv \lambda \mathbf{v}. \langle \sem{B}^*, \mathbf{v}\rangle \sem{K}, \\
    & \text{(Adjoint)} &&
    \sem{O^\dagger} \equiv \sem{O}^\dagger, \\
    & \text{(Scalar Operator)} &&
    \sem{S.O} \equiv \sem{S} \sem{O}, \\
    & \text{(Addition)} &&
    \sem{O_1 + O_2} \equiv \sem{O_1}+\sem{O_2}, \\
    & \text{(Operator Multiplication)} &&
    \sem{O_1 \cdot O_2} \equiv \sem{O_1} \cdot \sem{O_2}, \\
    & \text{(Tensor Product)} &&
    \sem{O_1 \otimes O_2} \equiv \sem{O_1} \otimes \sem{O_2},
  \end{align*}
\end{definition}


\subsubsection*{Example}


\newcommand{\tr}{\mathrm{tr}}
\newcommand{\pass}{\textcolor{blue}{\textbf{ [PASS] }}}
\newcommand{\fail}{\textcolor{red}{\textbf{ [FAIL] }}}

\section{Example List}

\subsection{Textbook Examples}

\begin{example}[QCQI (2.10)] \pass
  $$
  A\left( \sum_i a_i \ket{v_i} \right) = \sum_i a_i A(\ket{v_i}).
  $$
\end{example}

\begin{example}[QCQI (2.13)] \pass
  $$
  \left( \ket{v}, \sum_i \lambda_i \ket{w_i} \right) = \sum_i \lambda_i (\ket{v}, \ket{w_i}).
  $$
  $$
  (\ket{v}, \ket{w}) = (\ket{w}, \ket{v})^*.
  $$
\end{example}

\begin{example}[QCQI Exercise 2.6] \pass
  $$
  \left( \sum_i \lambda_i \ket{w_i}, \ket{v} \right) = \sum_i \lambda_i^* (\ket{w_i}, \ket{v}).
  $$
\end{example}

\begin{example}[QCQI (2.18)] \pass
  For orthonormal basis $\ket{i}$,
  $$
  \left( \sum_i v_i \ket{i}, \sum_j w_j \ket{j} \right) = \sum_{ij}v_i^*w_j \delta_{ij} = \sum_i v_i^* w_i.
  $$
\end{example}

\begin{example}[QCQI (2.21)] \pass
  $$
  \left( \sum_i \ket{i}\bra{i} \right) \ket{v} = \sum_i \ket{i} \braket{i|v}.
  $$
  Notice the slippery informal expression here. $\ket{v}$ should actually be $v$.
\end{example}

\begin{example}[QCQI (2.22)] \pass
  $$
  \sum_i\ket{i}\bra{i} = I.
  $$
  (In our language, identity operator $I$ will be a symbol.a)
\end{example}


\begin{example}[QCQI (2.24-2.25)] \pass
  $$
  \sum_{ij} \ket{w_j}\bra{w_j}A\ket{v_i}\bra{v_i} = \sum_{ij}\bra{w_j}A\ket{v_i}\ket{w_j}\bra{v_i}.
  $$
\end{example}

\begin{example}[QCQI (2.26)] \pass
  $$
  \braket{v|v}\braket{w|w} = \sum_i\braket{v|i}\braket{i|v}\braket{w|w}.
  $$
\end{example}
\textbf{Remark:} need to detect $\sum_{i\in\mathbf{U}}\ket{i}\bra{i} \to \mathbf{1}_\mathcal{O}$.

\begin{example}[QCQI Exercise 2.14] \pass
  $$
  \left( \sum_i a_i A_i \right)^\dagger = \sum_i a_i^* A_i^\dagger.
  $$
\end{example}

\begin{example}[QCQI Exercise 2.16] \pass
  Show that any projector $P\equiv \sum_{i=1}^k \ket{i}\bra{i}$ satisfies the equation $P^2=P$.
\end{example}

\begin{example}[QCQI (2.46)] \pass
  $$
    (A \otimes B)\left(\sum_i a_i \ket{v_i}\otimes\ket{w_i}\right) \equiv \sum_i a_i A \ket{v_i} \otimes B\ket{w_i}.
  $$
\end{example}

\begin{example}[QCQI (2.49)] \pass
  $$
    \left(\sum_i a_i \ket{v_i}\otimes\ket{w_i}, \sum_j b_j \ket{v'_j}\otimes \ket{w'_j}\right) \equiv \sum_{ij}a_i^*b_j\braket{v_i|v'_j}\braket{w_i|w'_j}.
  $$
\end{example}

\begin{example}[QCQI (2.61)] \pass
  $$
    \sum_i\bra{i}A\ket{\psi}\braket{\psi|i} = \bra{\psi}A\ket{\psi}.
  $$
\end{example}

% \begin{example}[QCQI Exercise 2.43] \fail
%   Show that for $j,k = 1,2,3$,
%   $$
%     \sigma_j\sigma_k = \delta_{jk}I + i\sum_{l=1}^3\epsilon_{jkl}\sigma_l.
%   $$
%   This can be checked with the help of Mathematica.
% \end{example}

\begin{example}[QCQI (2.128)] \pass
  $$
    \sum_{m',m''}\bra{\psi}M_m^\dagger\bra{m'}(I\otimes\ket{m}\bra{m})M_{m''}\ket{\psi}\ket{m''} = \bra{\psi}M_m^\dagger M_m\ket{\psi}.
  $$
\end{example}

\begin{example}[QCQI Theorem 4.1] \pass
  Suppose $U$ is a unitary operation on a single qubit. Then there exist real numbers $\alpha, \beta, \gamma$ and $\delta$ such that $$
  U = \left[
  \begin{array}{cc}
  e^{i(\alpha - \beta/2 - \delta/2)} \cos \frac{\gamma}{2} & -e^{i(\alpha - \beta/2 + \delta/2)} \sin \frac{\gamma}{2} \\
  e^{i(\alpha + \beta/2 - \delta/2)} \sin \frac{\gamma}{2} & e^{i(\alpha + \beta/2 + \delta/2)} \cos \frac{\gamma}{2}
  \end{array}
  \right]
  = e^{i\alpha}R_z(\beta)R_y(\gamma)R_z(\delta),
  $$
  where
\[
  R_x(\theta) \equiv
  \begin{bmatrix}
  \cos \frac{\theta}{2} & -i \sin \frac{\theta}{2} \\
  -i \sin \frac{\theta}{2} & \cos \frac{\theta}{2}
  \end{bmatrix}
  \qquad
  R_y(\theta) \equiv
  \begin{bmatrix}
  \cos \frac{\theta}{2} & -\sin \frac{\theta}{2} \\
  \sin \frac{\theta}{2} & \cos \frac{\theta}{2}
  \end{bmatrix}
  \qquad
  R_z(\theta) \equiv
  \begin{bmatrix}
  e^{-i \theta / 2} & 0 \\
  0 & e^{i \theta / 2}
  \end{bmatrix}
  \]
  are the rotation gates.
\end{example}


\subsection{Operation on maximally entangled state}
\begin{example} \pass
  Assume $S$ and $T$ are subsystems on Hilbert space $\mathcal{H}_T$ and $\ket{\Phi}_{S,T} = \sum_i \ket{i}\ket{i}$ is a maximally entangled state. Then for all operators $A\in\mathcal{L}(\mathcal{H}_T, \mathcal{H}_T)$, we have 
  $$
  A_S\ket{\Phi}_{S, T} = A_T^\top\ket{\Phi}_{S, T}.
  $$
\end{example}


\subsection{CoqQ Examples}
\begin{definition}
  Some high-level operators are encoded as follows.  
  \begin{gather*}
    \tr(A) \equiv \sum_{i\in\mathbf{U}} \bra{i} A \ket{i} \\
    SWAP(A) \equiv \sum_{i\in\mathbf{U}}\sum_{j\in\mathbf{U}}\sum_{k\in\mathbf{U}}\sum_{l\in\mathbf{U}} \bra{i, j} A \ket{k, l} \ket{j, i}\bra{l, k} \\
    \tr_1(A) \equiv \sum_{i\in\mathbf{U}}\sum_{j\in\mathbf{U}} (\sum_{k\in\mathbf{U}} \bra{k, i} A \ket{k, j}) \ket{i}\bra{j} \\
    \tr_2(A) \equiv \sum_{i\in\mathbf{U}}\sum_{j\in\mathbf{U}} (\sum_{k\in\mathbf{U}} \bra{i, k} A \ket{j, k}) \ket{i}\bra{j} \\
    so2choi(E) \equiv \sum_{i\in\mathbf{U}}\sum_{j\in\mathbf{U}} \ket{i}\bra{j} \otimes (\sum_{k\in\mathbf{U}} E_k \ket{i}\bra{j} E_k^\dagger) \\
    krausso(M, f)(X) \equiv \sum_{i \in M} f_i \cdot X \cdot f_i^\dagger \\
    elemso(f, k)(X) \equiv f_k \cdot X \cdot f_k^\dagger \\
    dualqm(M, f)(O) \equiv \sum_{i\in M} f_i^\dagger \cdot O_i \cdot f_i
  \end{gather*}
\end{definition}

Note: the identity operator is encoded as $\sum_{i \in \mathbf{U}}\ket{i}\bra{i}$, not $\mathbf{1}_\mathcal{O}$. They are different.

(In the order of their appearance in CoqQ.)
\begin{enumerate}
  \item \pass $\bra{p}A\ket{i}\braket{j|q} = \delta_{j,q}\bra{p}A\ket{i}$
  \item \pass $\bra{p}(\ket{i}\bra{j}A)\ket{q} = \delta_{i, p}\bra{j}A\ket{q}$
  \item \pass $\bra{i}M^*\ket{j} = \bra{i}M\ket{j}^*$
  \item \pass $\bra{i}M^\dagger\ket{j} = \bra{j}M\ket{i}^*$
  \item \pass $(a A + B)^* = a^* A^* + B^*$
  \item \pass $(A+B)^\dagger = A^\dagger + B^\dagger$
  \item \pass $(c A)^\dagger = c^* A^\dagger$
  \item \pass $(c A + B)^\dagger = c^* A^\dagger + B^\dagger$
  \item \pass $(A \cdot B)^\dagger = B^\dagger \cdot A^\dagger$
  \item \pass $(M^\dagger)^\dagger = M$
  \item \pass $(aI)^\dagger = a^* I$
  \item \pass $(1 I)^\dagger = I$
  \item \pass $(\ket{i}\bra{j})^* = \ket{i}\bra{j}$
  \item \pass $(\ket{i}\bra{j})^\dagger = \ket{j}\bra{i}$
  \item \pass $M^\top = (M^*)^\dagger$
  \item \pass $M^\top = (M^\dagger)^*$
  \item \pass $M^* = (M^\dagger)^\top$
  \item \pass $\tr(M^\dagger) = \tr(M)^*$
  \item \pass $\tr(M^*) = \tr(M)^*$
  \item \pass $(\bra{i}M)^\dagger = M^\dagger \ket{i}$
  \item \pass $(M \ket{i})^\dagger = \bra{i} M^\dagger$
  \item \pass $\bra{u} \left( \sum_{i} a_i \ket{i}\bra{i} \right) \ket{u} = \sum_i a_i \braket{u|i}\braket{i|u}$
  \item \pass $\bra{i}(A\cdot B^\dagger)\ket{j} = \bra{i} A (\bra{j}B)^\dagger$
  \item \pass $A \cdot B = \sum_i (A \ket{i})(\bra{i} B)$
  \item \pass $\bra{i}(\sum_{i \in \mathbf{U}} d_i \ket{i}\bra{i} A) = d_i \bra{i} A$
  \item \pass $\tr(A) = \sum_{i \in \mathbf{U}}\bra{i} A \ket{i}$
  \item \pass $\tr(A B) = \tr(B A)$ (entry expansion is critical here)
  \item \pass $\tr(c A + B) = c\ \tr(A) + \tr(B)$
  \item \pass $\tr(A^\dagger) = \tr(A)^*$
  \item \pass $\tr(A^\top) = \tr(A)$
  \item \pass $\tr(A^*) = \tr(A)^*$
  \item \pass $\tr(\ket{u}\bra{v}) = \braket{v|u}$
  \item \pass $\tr(\ket{u}\bra{v}) = \braket{v|u}$ ($u$, $v$ are arbitrary vectors)
  \item \pass $\sum_{i\in\mathbf{U}} \ket{i}\bra{i} = I$
  \item \pass $\ket{i}\bra{j}\cdot\ket{k}\bra{l} = \delta_{j,k}\ket{i}\bra{l}$
  \item \pass $\ket{i}\bra{j}\cdot\ket{j}\bra{k} = \ket{i}\bra{k}$
  \item \pass $\tr(A \ket{i}\bra{j}) = \bra{j} (A \ket{i})$
  \item \pass $A = \sum_{j\in\mathbf{U}}\sum_{i\in\mathbf{U}} \bra{i}(A\ket{j}) \ket{i}\bra{j}$
  \item \pass $\ket{v} = \sum_{i\in\mathbf{U}}(\braket{i|v})\ket{i}$
  \item \pass $(A\ket{u})\bra{v} = A(\ket{u}\bra{v})$
  \item \pass $\ket{u}(A\ket{v})^\dagger = (\ket{u}\bra{v})A^\dagger$
  \item \pass $\bra{b} = \sum_{i\in\mathbf{U}}(\braket{b|i}\bra{i})$
  \item \pass $(A\cdot B)\ v = A (B\ v)$
  \item \pass $\sum_{i}\sum_{j}F_i G_j A G_j^\dagger F_i^\dagger = \sum_i F_i (\sum_j G_j A G_j^\dagger) F_i^\dagger$
  \item \pass $(A\cdot B)\cdot C = A \cdot (B \cdot C)$
  \item \pass $\sum_i F_i \cdot (\sum_j \sum_k G_j \cdot H_k \cdot A \cdot H_k^\dagger \cdot G_j^\dagger) \cdot F_i^\dagger = \sum_i \sum_j F_i \cdot G_j \cdot (\sum_k H_k \cdot A \cdot H_k^\dagger) \cdot G_j^\dagger \cdot F_i^\dagger$
  \item \pass $A\cdot(a B + C) = a (A\cdot B) + (A\cdot C)$
  \item \pass $(A_1 + A_2)\cdot B = A_1 \cdot B + A_2 \cdot B$
  \item \pass $A \cdot (B_1 + B_2) = A \cdot B_1 + A \cdot B_2$
  \item \pass $(-A) \cdot B = - (A \cdot B)$
  \item \pass $A \cdot (-B) = - (A \cdot B)$
  \item \pass $(k A) \cdot B = k (A \cdot B)$
  \item \pass $A \cdot (k B) = k (A \cdot B)$
  \item \pass $(k A_1 + A_2) \cdot B = k (A_1 \cdot B) + A_2 \cdot B$
  \item \pass $A \cdot (k B_1 + B_2) = k (A \cdot B_1) + A \cdot B_2$
  \item \pass $A \cdot B \cdot C \cdot D = A \cdot (B \cdot C) \cdot D$
  \item \pass $\sum_i \sum_j br_{i, j} \cdot ((f_i \cdot (a X + Y)) \cdot f_i^\dagger \cdot br_{i, j}^\dagger) = \sum_i a \sum_j br_{i, j} \cdot ((f_i \cdot X) \cdot f_i^\dagger) \cdot br_{i, j}^\dagger + \sum_i \sum_j br_{i, j} \cdot ((f_i \cdot Y) \cdot f_i^\dagger) \cdot br_{i, j}^\dagger$
  \item \pass $c > 0 \to c \sum_i (f_i \cdot X \cdot f_i^\dagger) = \sum_i ((\sqrt{c} f_i \cdot X) \cdot (\sqrt{c} f_i^\dagger))$
  \item \pass $(M \otimes N)^\dagger = M^\dagger \otimes N^\dagger$
  \item \pass $\tr (M \otimes N) = \tr(M) \tr(N)$ (Index split is required)
  \item \pass $SWAP(SWAP(A))=A$
  \item \pass $A = \sum_{i \in \mathbf{U}} \bra{\fst i} A \ket{\snd i} \ket{\fst i} \bra{\snd i}$
  \item \pass $\sum_{i\in T} f_i \cdot (\sum_{j \in R} g_j \cdot X \cdot g_j^\dagger) \cdot f_i^\dagger = \sum_{i \in T\times R} f_{\fst k} \cdot g_{\snd k} \cdot X \cdot f_{\fst k}^\dagger \cdot g_{\snd k}^\dagger$
  \item \pass $SWAP(a X + Y) = a SWAP(X) + SWAP(Y)$
  \item \pass $SWAP(A\otimes B) = B \otimes A$
  \item \pass $\tr(SWAP(A)) = \tr(A)$
  \item \pass $SWAP(A \cdot B) = SWAP(A) \cdot SWAP(B)$
  \item \pass $SWAP(A)^\top = SWAP(A^\top)$
  \item \pass $SWAP(A)^\dagger = SWAP(A^\dagger)$
  \item \pass $\tr_2(A) = \tr_1(SWAP(A))$
  \item \pass $\tr_1(A) = \tr_2(SWAP(A))$
  \item \pass $\tr_2(c A + B) = c \tr_2(A) + \tr_2(B)$
  \item \pass $\tr(A) = \tr(\tr_2(A))$
  \item \pass $\tr(A) = \tr(\tr_1(A))$
  \item \pass $\tr_1 (A \cdot (I \otimes B)) = \tr_1 (A) \cdot B$
  \item \pass $I \otimes I = I$
  \item \pass $\bra{i} A \cdot B \ket{j} = \sum_{a\in\mathbf{U}} \sum_{b\in\mathbf{U}} \bra{i}A\ket{a,b}\bra{a,b}B\ket{j}$
  \item \pass $\bra{k,p} ((\ket{i}\bra{j} \otimes I) \cdot A) \ket{q} = \delta_{i, k} \bra{j, p} A \ket{q}$
  \item \pass $\bra{p} (A \cdot (\ket{i}\bra{j} \otimes I)) \ket{k, q} = \delta_{j, k} \bra{p} A \ket{i, q}$
  \item \pass $\tr_1(so2choi(E) \cdot (X^\top \otimes I)) = \sum_{k\in\mathbf{U}} E_k X E_k^\dagger$
  \item \fail $so2choi(a X + Y) =a\ so2choi(X) + so2choi(Y)$ ($aX + Y$ is not well formalized)
  \item \pass $\tr_2(A \cdot (B \otimes I)) = \tr_2(A) \cdot B$
  \item \pass $\tr (so2choi(E)\cdot (X^\top \otimes Y)) = \tr(E(X) \cdot Y)$
  \item \pass $\tr (E(X) \cdot A) = \tr (X \cdot E^*(A))$
  \item \pass $\tr (A \cdot E(X)) = \tr (E^*(X) \cdot A)$
  \item \pass $\sum_{i \in \mathbf{U}} \ket{v}\bra{i} X \ket{i}\bra{v} = \tr(X) * \ket{v}\bra{v}$
  \item \pass $\sum_{i \in \mathbf{U}} \ket{i}\bra{v}X\ket{v}\bra{i} = \bra{v}X\ket{v} I$
  \item \pass $\sum_{i \in M} elemso(f, i)(X) = krausso(M, f)(X)$
  \item \pass $\sum_{i \in M} \tr(elemso(f,i)(X)\cdot O_i) = \tr (X \cdot dualqm(M, f)(O))$
  \item \pass $\sum_{i \in M} \tr(O_i \cdot elemso(f,i)(X)) = \tr (dualqm(M,f)(O)\cdot X)$
\end{enumerate}

\subsection{PQC/Quantum Black Box Equivalence Checking}
\begin{figure*}[h]
  \includegraphics*[width=\textwidth]{fig/QCQI.Fig4.5.png}
\end{figure*}

\begin{figure*}[h]
  \includegraphics*[width=\textwidth]{fig/QCQI.Fig4.8.png}
\end{figure*}


\subsection{Semnatic Calculation of a Simple qWhile Program}
We formalized the small-step operational semantics of quantum while programs as a term rewriting system.
\begin{definition}[TRS for qWhile]
  \begin{align*}
    \langle \textbf{abort}, \rho \rangle &\longrightarrow \langle \textbf{Halt}, \textbf{0}_\mathcal{O} \rangle \\
    \langle \textbf{skip}, \rho \rangle &\longrightarrow \langle \textbf{Halt}, \rho \rangle \\
    \langle q :=0, \rho \rangle &\longrightarrow \langle \textbf{Halt}, \sum_{i \in \textbf{U}} (\ket{0}\otimes\bra{1})_{q;q} \cdot \rho \cdot (\ket{1}\otimes\bra{0})_{q;q} \rangle \\
    \langle U, \rho \rangle & \longrightarrow \langle \textbf{Halt}, U \cdot \rho \cdot U^\dagger \rangle \\
    \langle \textbf{if } P \textbf{ then } S_1 \textbf{ else } S_2 \textbf{ end}, \rho \rangle &\longrightarrow \{| \langle S_1, P \cdot \rho \cdot P \rangle, \langle S_2, (\mathbf{1}_\mathcal{O} + (-1).P) \cdot \rho \cdot (\mathbf{1}_\mathcal{O} + (-1).P)\rangle |\} \\
     & \vdots
  \end{align*}
  Note that the calculations of quantum states are represented by the syntax of Dirac notations defined above.
\end{definition}

\begin{example}
  $\langle \textbf{ while}^2\ (\ket{0}\otimes\bra{0})_q \textbf{ do } X_q\ \textbf{end}, (\ket{0}\otimes\bra{0})_q \rangle \longrightarrow \langle \textbf{ Halt}, (\ket{1}\otimes\bra{1})_q \rangle$
\end{example}

\textbf{Remark:} It should take 140 steps to complete the calculation!




\section{Labelled Dirac Notation}

\begin{definition}[quantum registers]
  \begin{align*}
    R ::= x\ |\ (R, R)\ |\ \fst R\ |\ \snd R
  \end{align*}
  We define the following relations for quantum registers:
  \begin{itemize}
    \item $R$ \textbf{belongs to} $Q$, written as $R\ \text{in}\ Q$,
    \item $R$ \textbf{is disjoint with} $Q$, written as $R \| Q$.
  \end{itemize}
\end{definition}

\textbf{Remark:} We still have a speical algorithm deciding the relations.

\begin{definition}[register set]
  \begin{align*}
    S ::= \emptyset\ |\ \{ R \} \ |\ S \cup S\ |\ S \setminus S
  \end{align*}
\end{definition}

\textbf{Remark: } $ S_1 \cap S_2 \equiv S_1 \cup S_2 \setminus (S_1 \setminus S_2) \setminus (S_2 \setminus S_1) $

\subsubsection*{\textsf{REG}}
\begin{gather*}
  \fst (R_1, R_2) \reduce R_1 \qquad 
  \snd (R_1, R_2) \reduce R_2 \qquad
  (\fst R, \snd R) \reduce R
\end{gather*}


\subsubsection*{\textsf{RSET}}
\begin{gather*}
  S \cup \emptyset \reduce S
  \qquad
  S \cup S \reduce S
  \qquad
  \{ \fst R \} \cup \{ \snd R \} \reduce R \\
  S \setminus \emptyset \reduce S
  \qquad
  \emptyset \setminus S \reduce \emptyset
  \qquad
  S \setminus S \reduce \emptyset \\
  (S_1 \cup S_2) \setminus X \reduce (S_1 \setminus X) \cup (S_2 \setminus X)
  \qquad
  S_1 \setminus (S_2 \cup S_3) \reduce (S_1 \setminus S_2) \setminus S_3 \\
  \\
  \frac{ R_1 \textrm{ in } R_2 }{ \{ R_1 \} \cup \{ R_2 \} \reduce \{ R_2 \} }
  \qquad
  \frac{ R_1 \textrm{ in } R_2 }{ \{ R_1 \} \setminus \{ R_2 \} \reduce \emptyset } \\
  \\
  \frac{ R_1 \textrm{ in } R_2 }{ \{R_2\} \setminus \{R_1\} \reduce (\{\fst R_2\} \setminus \{R_1\}) \cup (\{\snd R_2\} \setminus \{R_1\})}
  \qquad
  \frac{R_1 \| R_2}{ \{ R_1 \} \setminus \{ R_2 \} \reduce \{ R_1 \}} 
\end{gather*}

\begin{definition}[labelled core language]
  The \textbf{labelled core langauge} includes all symbols in the core language of Dirac notation, as well as symbols for the three new sorts.
  \begin{align*}
    & && S ::=\ \tilde{B} \cdot \tilde{K} \\
    & \tilde{\mathcal{K}}\text{(labelled ket)}&& \tilde{K} ::=\ K_{R}\ |\ \tilde{B}^\dagger\ |\ S.\tilde{K}\ |\ \tilde{K} + \tilde{K}\ |\ \tilde{O} \cdot \tilde{K}\ |\ \tilde{K} \otimes \tilde{K} \\
    & \tilde{\mathcal{B}}\text{(labelled bra)} && \tilde{B} ::=\ B_{R}\ |\ \tilde{K}^\dagger\ |\ S.\tilde{B}\ |\ \tilde{B} + \tilde{B}\ |\ \tilde{B} \cdot \tilde{O}\ |\ \tilde{B} \otimes \tilde{B} \\
    & \tilde{\mathcal{O}}\text{(labelled operator)} &&\tilde{O} ::=\ O_{R; R}\ |\ \tilde{K}\otimes\tilde{B}\ |\ \tilde{O}^\dagger\ |\ S.\tilde{O}\ |\ \tilde{O} + \tilde{O}\ |\ \tilde{O} \cdot \tilde{O}\ |\ \tilde{O} \otimes \tilde{O}
  \end{align*}
  In other words, we don't allow variables for labelled core language for now.
\end{definition}

\subsubsection*{\textsf{LABEL-CORE}}
We generally copied the symbols ($\dagger, S.\tilde{X}, +, \cdot, \otimes$) from the core language. Therefore we also need a copy of the corresponding rewriting rules.

\subsubsection*{\textsf{TSR-DECOMP}}

\begin{gather*}
  \ket{(s, t)}_{(Q, R)} \reduce \ket{s}_{Q} \otimes \ket{t}_{R}
  \qquad
  \bra{(s, t)}_{(Q, R)} \reduce \bra{s}_{Q} \otimes \bra{s}_{R} \\
  {\mathbf{0}_\mathcal{K}}_{(Q, R)} \reduce {\mathbf{0}_\mathcal{K}}_{Q} \otimes {\mathbf{0}_\mathcal{K}}_{R}
  \qquad
  {\mathbf{0}_\mathcal{B}}_{(Q, R)} \reduce {\mathbf{0}_\mathcal{B}}_{Q} \otimes {\mathbf{0}_\mathcal{B}}_{R} \\
  {\mathbf{0}_\mathcal{O}}_{(Q, R); (S, T)} \reduce {\mathbf{0}_\mathcal{O}}_{(Q, S)} \otimes {\mathbf{0}_\mathcal{O}}_{(R, T)} \\
  {\mathbf{0}_\mathcal{O}}_{(Q_1, Q_2); R} \reduce {\mathbf{0}_\mathcal{O}}_{Q_1; \fst R} \otimes {\mathbf{0}_\mathcal{O}}_{Q_2; \fst R}
  \qquad
  {\mathbf{0}_\mathcal{O}}_{Q; (R_1, R_2)} \reduce {\mathbf{0}_\mathcal{O}}_{\fst Q; R_1} \otimes {\mathbf{0}_\mathcal{O}}_{\snd Q; R_2} \\
  {\mathbf{1}_\mathcal{O}}_{(Q, R); (Q, R)} \reduce {\mathbf{1}_\mathcal{O}}_{Q; Q} \otimes {\mathbf{1}_\mathcal{O}}_{R; R} \\
  {\mathbf{1}_\mathcal{O}}_{(Q_1, Q_2); R} \reduce {\mathbf{1}_\mathcal{O}}_{Q_1; \fst R} \otimes {\mathbf{1}_\mathcal{O}}_{Q_2; \fst R}
  \qquad
  {\mathbf{1}_\mathcal{O}}_{Q; (R_1, R_2)} \reduce {\mathbf{1}_\mathcal{O}}_{\fst Q; R_1} \otimes {\mathbf{1}_\mathcal{O}}_{\snd Q; R_2}
\end{gather*}
\begin{gather*}
  (K_1 \otimes K_2)_{(Q, R)} \reduce {K_1}_{Q} \otimes {K_2}_{R}
  \qquad
  (B_1 \otimes B_2)_{(Q, R)} \reduce {B_1}_{Q} \otimes {B_2}_{R} \\
  (O_1 \otimes O_2)_{(Q, R); (S, T)} \reduce {O_1}_{Q; S} \otimes {O_2}_{R; T} \\
  (O_1 \otimes O_2)_{(Q_1, Q_2); R} \reduce {O_1}_{Q_1; \fst R} \otimes {O_2}_{Q_2; \snd R}
  \qquad
  (O_1 \otimes O_2)_{Q; (R_1, R_2)} \reduce {O_1}_{\fst Q; R_1} \otimes {O_2}_{\snd Q; R_2}
\end{gather*}


\subsubsection*{\textsf{TSR-COMP}}
\begin{gather*}
  {K_1}_{\fst R} \otimes {K_1}_{\snd R} \reduce (K_1 \otimes K_2)_{R}
  \qquad
  {B_1}_{\fst R} \otimes {B_2}_{\snd R} \reduce (B_1 \otimes B_2)_{R} \\
  {O_1}_{\fst Q; \fst R} \otimes {O_2}_{\snd Q; \snd R} \reduce (O_1 \otimes O_2)_{Q; R}
\end{gather*}

\subsubsection*{\textsf{DOT-TSR}}
\begin{align*}
  \frac{R \| S}{{O_1}_{Q; R} \cdot {O_2}_{S; T} \reduce {O_1}_{Q; R} \otimes {O_2}_{S; T}}
\end{align*}

\subsubsection*{\textsf{LABEL-LIFT}}
\begin{gather*}
  (K_{R})^\dagger \reduce (K^\dagger)_{R}
  \qquad
  (B_{R})^\dagger \reduce (B^\dagger)_{R}
  \qquad
  (O_{Q; R})^\dagger \reduce (O^\dagger)_{Q; R} \\
  (K_{R})^\top \reduce (K^\top)_{R}
  \qquad
  (B_{R})^\top \reduce (B^\top)_{R}
  \qquad
  (O_{Q; R})^\top \reduce (O^\top)_{Q; R} \\
  (S.K)_{R} \reduce S.(K_{R})
  \qquad
  (S.B)_{R} \reduce S.(B_{R})
  \qquad
  (S.O)_{Q; R} \reduce S.(O_{Q; R}) \\
  (K_1 + K_2)_{R} \reduce {K_1}_{R} + {K_2}_{R}
  \qquad
  (B_1 + B_2)_{R} \reduce {B_1}_{R} + {B_2}_{R}
  \qquad
  (O_1 + O_2)_{Q; R} \reduce {O_1}_{Q; R} + {O_2}_{Q; R}
\end{gather*}
\begin{gather*}
  {O_1}_{Q; R} \cdot {O_2}_{R; S} \reduce (O_1 \cdot O_2)_{Q; S}
  \qquad
  O_{Q; R} \cdot K_{R} \reduce (O \cdot K)_{Q}
  \qquad
  B_{Q} \cdot O_{Q; R} \reduce (B \cdot O)_{R} \\
  B_{R} \cdot K_{R} \reduce B \cdot K \\
  (K \otimes B)_{Q; R} \reduce K_{Q} \otimes B_{R}
\end{gather*}

\subsubsection*{\textsf{OPT-EXT}}
I think the concept ``cylinder extension'' is only limited to endomorphisms. Besides, one quantum register should a sub-register of the other one, which is defined as follows:

\begin{definition}[sub-register]
  \begin{gather*}
    \fst R \preceq R \qquad \snd R \preceq R \qquad Q \preceq (Q, R) \qquad R \preceq (Q, R)
    \qquad 
    \frac{Q \preceq R \qquad R \preceq S}{Q \preceq S}
  \end{gather*}

  And we can further calculate the ``position'' of sub-register, which will be utilized during cylinder extension: assume $Q$ is a sub-register of $R$, then the position of $Q$ in $R$ is a string defined as follows:
  \begin{align*}
    & \textrm{pos}(\fst R, R) = 0 \\
    & \textrm{pos}(\snd R, R) = 1 \\
    & \textrm{pos}(Q, (Q, R)) = 0 \\
    & \textrm{pos}(R, (Q, R)) = 1 \\
    & \textrm{pos}(Q, S) = \textrm{pos}(R, S)\ \textrm{pos}(Q, R)
  \end{align*}
\end{definition}

\textbf{Remark:} For a well-formed quantum register, the sub-register position is well-defined.

\begin{definition}[cylinder extension]
  \begin{align*}
    \textrm{ext}(O, \epsilon) \equiv O
    && \textrm{ext}(O, p::0) \equiv O \otimes \mathbf{1}_\mathcal{O}
    && \textrm{ext}(O, p::1) \equiv \mathbf{1}_\mathcal{O} \otimes O
  \end{align*}
\end{definition}

\subsubsection*{\textsf{CYLINDER-EXT}}
\begin{gather*}
  \frac{Q \textrm{ is a subterm of } R \textrm{ at } p}{O_{Q; Q} \cdot K_{R} \reduce (\textrm{ext}(O, p) \cdot K)_{R}}
  \qquad
  \frac{Q \textrm{ is a subterm of } R \textrm{ at } p}{{O_1}_{Q; Q} \cdot {O_2}_{R; T} \reduce (\textrm{ext}(O_1, p) \cdot O_2)_{R; T}} \\
  \\
  \frac{R \textrm{ is a subterm of } Q \textrm{ at } p}{B_{Q} \cdot O_{R; R} \reduce (B \cdot \textrm{ext}(O, p))_{Q}}
  \qquad
  \frac{R \textrm{ is a subterm of } Q \textrm{ at } p}{{O_1}_{T; Q} \cdot {O_2}_{R; T} \reduce (O_1 \cdot \textrm{ext}(O_2, p))_{T; Q}} \\
\end{gather*}


\subsection{Labelled Extended Language}
\begin{definition}[labelled extended language]
  The \textbf{labelled extended language} consists of the symbols in labelled core langauge and unlabelled extended language, and add the new symbols of transpose and big-op for labelled bra, ket and operators, which is described in the following.
  \begin{align*}
    \tilde{K} ::= \tilde{B}^\top\ |\ \sum_{i \in M} \tilde{K}
    && \tilde{B} ::= \tilde{K}^\top\ |\ \sum_{i \in M} \tilde{B}
    && \tilde{O} ::= \tilde{O}^\top\ |\ \sum_{i \in M} \tilde{O}
  \end{align*}
  
\end{definition}


\subsubsection*{\textsf{LABEL-SUM}}
\begin{gather*}
  (\sum_{i \in M} K)_{R} \reduce \sum_{i \in M} (K_{R})
  \qquad
  (\sum_{i \in M} B)_{R} \reduce \sum_{i \in M} (B_{R})
  \qquad
  (\sum_{i \in M} O)_{Q; R} \reduce \sum_{i \in M} (O_{Q; R})
\end{gather*}

\subsubsection*{\textsf{LABEL-TEMP}}
\yx{These are ad-hoc rules for the examples for now. They are still not organized and require further investigations.}
\begin{gather*}
  \frac{R \textsf{ in } Q}{O_{P; R} \cdot (K_{Q} \otimes \tilde{K'}) \reduce (O_{P; R} \cdot K_{Q}) \otimes \tilde{K'}} 
  \qquad
  \frac{R \textsf{ in } Q}{O_{P; R} \cdot (K_{Q} \otimes \tilde{B}) \reduce (O_{P; R} \cdot K_{Q}) \otimes \tilde{B}} \\
  \\
  \frac{R \textsf{ in } Q}{{O_1}_{P; R} \cdot ({O_2}_{Q; T} \otimes \tilde{O_3}) \reduce ({O_1}_{P; R} \cdot {O_2}_{Q; T}) \otimes \tilde{O_3}} \\
  \\
  \frac{Q \textsf{ in } R}{(B_{R} \otimes \tilde{B'}) \cdot O_{Q;P} \reduce (B_{R} \cdot O_{Q;P}) \otimes \tilde{B'}} 
  \qquad
  \frac{Q \textsf{ in } R}{({O_1}_{T;R} \otimes \tilde{O'}) \cdot {O_2}_{Q;P} \reduce ({O_1}_{T;R} \cdot {O_2}_{Q;P}) \otimes \tilde{O'}} \\
  \\
  B_{R} \cdot (K_{R} \otimes \tilde{B'}) \reduce (B_{R} \cdot K_{R}) . \tilde{B'} 
  \qquad
  (\tilde{K'} \otimes B_{R}) \cdot K_{R} \reduce (B_{R} \cdot K_{R}) . \tilde{K'}
\end{gather*}


\end{document}
\endinput